<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô phỏng Lan truyền Sóng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0f172a;
            color: #f8fafc;
            overflow: hidden;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .canvas-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr 300px;
        }
        .simulation-area {
            display: flex;
            flex-direction: column;
            height: 100vh;
            border-right: 1px solid #334155;
        }
        .wave-section {
            position: relative;
            flex: 1; /* Chia đều không gian 50/50 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
        }
        .wave-section:first-child {
            border-bottom: 2px solid #334155;
        }
        .label {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(15, 23, 42, 0.9);
            padding: 6px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border: 1px solid #38bdf8;
            color: #38bdf8;
            z-index: 10;
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        .controls {
            padding: 24px;
            background: #1e293b;
            display: flex;
            flex-direction: column;
            gap: 24px;
            overflow-y: auto;
            box-shadow: -4px 0 15px rgba(0,0,0,0.3);
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        label {
            font-size: 0.9rem;
            color: #94a3b8;
            display: flex;
            justify-content: space-between;
        }
        input[type="range"] {
            width: 100%;
            cursor: pointer;
            accent-color: #38bdf8;
        }
        .highlight-text {
            color: #38bdf8;
            font-family: monospace;
            font-size: 1rem;
        }
        .info-card {
            background: rgba(30, 41, 59, 0.5);
            border-left: 4px solid #38bdf8;
            padding: 16px;
            border-radius: 4px;
            font-size: 0.85rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>

<div class="canvas-container">
    <div class="simulation-area">
        <!-- Trên: Sóng ngang -->
        <div class="wave-section">
            <div class="label">Sóng Ngang (Transverse Wave)</div>
            <canvas id="transverseCanvas"></canvas>
        </div>
        <!-- Dưới: Sóng dọc -->
        <div class="wave-section">
            <div class="label" style="border-color: #fbbf24; color: #fbbf24;">Sóng Dọc (Longitudinal Wave)</div>
            <canvas id="longitudinalCanvas"></canvas>
        </div>
    </div>

    <div class="controls">
        <div>
            <h2 class="text-xl font-bold text-white">Mô phỏng Sóng</h2>
            <p class="text-xs text-slate-400 mt-1">Trực quan hóa vật lý cơ bản</p>
        </div>
        
        <div class="control-group">
            <label>Biên độ (A) <span id="ampVal" class="highlight-text">40</span></label>
            <input type="range" id="amplitude" min="5" max="100" value="40">
        </div>

        <div class="control-group">
            <label>Tần số (f) <span id="freqVal" class="highlight-text">0.02</span></label>
            <input type="range" id="frequency" min="0.005" max="0.05" step="0.001" value="0.02">
        </div>

        <div class="control-group">
            <label>Tốc độ (v) <span id="speedVal" class="highlight-text">0.1</span></label>
            <input type="range" id="speed" min="0.02" max="0.4" step="0.01" value="0.1">
        </div>

        <div class="control-group">
            <label>Mật độ phần tử <span id="densityVal" class="highlight-text">50</span></label>
            <input type="range" id="density" min="20" max="120" value="50">
        </div>

        <div class="info-card">
            <p class="font-bold text-white mb-2">Đánh dấu bước sóng (λ):</p>
            <ul class="space-y-2 text-slate-300">
                <li>• Khoảng cách giữa 2 vạch trắng dưới cùng là <strong>1 bước sóng</strong>.</li>
                <li>• λ phụ thuộc vào Tốc độ (v) và Tần số (f) theo công thức: <span class="text-sky-400">λ = v / f</span>.</li>
                <li>• Hãy thử tăng tốc độ v hoặc giảm tần số f để thấy λ dài ra.</li>
            </ul>
        </div>

        <button id="resetBtn" class="mt-4 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-2 px-4 rounded transition border border-slate-500">
            Cài đặt lại
        </button>
    </div>
</div>

<script>
    const tCanvas = document.getElementById('transverseCanvas');
    const lCanvas = document.getElementById('longitudinalCanvas');
    const tCtx = tCanvas.getContext('2d');
    const lCtx = lCanvas.getContext('2d');

    const inputs = {
        amplitude: document.getElementById('amplitude'),
        frequency: document.getElementById('frequency'),
        speed: document.getElementById('speed'),
        density: document.getElementById('density')
    };

    const displays = {
        amplitude: document.getElementById('ampVal'),
        frequency: document.getElementById('freqVal'),
        speed: document.getElementById('speedVal'),
        density: document.getElementById('densityVal')
    };

    let time = 0;

    function resize() {
        tCanvas.width = tCanvas.offsetWidth;
        tCanvas.height = tCanvas.offsetHeight;
        lCanvas.width = lCanvas.offsetWidth;
        lCanvas.height = lCanvas.offsetHeight;
    }

    window.addEventListener('resize', resize);
    resize();

    // Hàm vẽ thước đo bước sóng
    function drawWavelengthMarker(ctx, canvas, amp, freq, speed, color) {
        // λ trong mô phỏng này tỷ lệ thuận với speed và nghịch đảo với freq
        // Dựa vào công thức pha: phase = time * speed - i * freq * 15
        // Bước sóng λ (khoảng cách giữa 2 điểm cùng pha) tính bằng pixel là:
        const lambdaPixels = (2 * Math.PI) / (freq * 15) * (tCanvas.width / (parseInt(inputs.density.value) + 1));
        
        const startX = 50;
        const endX = startX + lambdaPixels;
        const y = canvas.height - 30;

        ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
        ctx.lineWidth = 2;

        // Vẽ đường ngang
        ctx.beginPath();
        ctx.moveTo(startX, y);
        ctx.lineTo(endX, y);
        ctx.stroke();

        // Vẽ 2 vạch đứng chặn đầu
        ctx.beginPath();
        ctx.moveTo(startX, y - 10); ctx.lineTo(startX, y + 10);
        ctx.moveTo(endX, y - 10); ctx.lineTo(endX, y + 10);
        ctx.stroke();

        // Vẽ chữ Lambda
        ctx.fillStyle = 'white';
        ctx.font = 'bold 16px serif';
        ctx.textAlign = 'center';
        ctx.fillText('λ', (startX + endX) / 2, y - 10);
    }

    function draw() {
        const amp = parseFloat(inputs.amplitude.value);
        const freq = parseFloat(inputs.frequency.value);
        const speed = parseFloat(inputs.speed.value);
        const count = parseInt(inputs.density.value);

        displays.amplitude.innerText = amp;
        displays.frequency.innerText = freq;
        displays.speed.innerText = speed;
        displays.density.innerText = count;

        tCtx.clearRect(0, 0, tCanvas.width, tCanvas.height);
        lCtx.clearRect(0, 0, lCanvas.width, lCanvas.height);

        const spacing = tCanvas.width / (count + 1);
        const centerY_T = tCanvas.height / 2;
        const centerY_L = lCanvas.height / 2;

        // Vẽ lưới mờ
        tCtx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
        tCtx.beginPath();
        tCtx.moveTo(0, centerY_T); tCtx.lineTo(tCanvas.width, centerY_T);
        tCtx.stroke();

        lCtx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
        lCtx.beginPath();
        lCtx.moveTo(0, centerY_L); lCtx.lineTo(lCanvas.width, centerY_L);
        lCtx.stroke();

        // Vẽ Sóng Ngang
        for (let i = 1; i <= count; i++) {
            const x = i * spacing;
            const phase = time * speed - i * freq * 15;
            const y = centerY_T + amp * Math.sin(phase);

            const isRed = (i === Math.floor(count / 4));
            
            tCtx.beginPath();
            tCtx.arc(x, y, isRed ? 7 : 4, 0, Math.PI * 2);
            tCtx.fillStyle = isRed ? '#f87171' : '#38bdf8';
            if (isRed) {
                tCtx.shadowBlur = 15;
                tCtx.shadowColor = '#f87171';
            } else {
                tCtx.shadowBlur = 0;
            }
            tCtx.fill();
            
            if (i > 1) {
                const prevX = (i - 1) * spacing;
                const prevY = centerY_T + amp * Math.sin(time * speed - (i - 1) * freq * 15);
                tCtx.beginPath();
                tCtx.moveTo(prevX, prevY);
                tCtx.lineTo(x, y);
                tCtx.strokeStyle = 'rgba(56, 189, 248, 0.15)';
                tCtx.lineWidth = 1;
                tCtx.stroke();
            }
        }
        drawWavelengthMarker(tCtx, tCanvas, amp, freq, speed, '#38bdf8');

        // Vẽ Sóng Dọc
        tCtx.shadowBlur = 0; 
        for (let i = 1; i <= count; i++) {
            const baseX = i * spacing;
            const phase = time * speed - i * freq * 15;
            const xOffset = amp * Math.sin(phase);
            const x = baseX + xOffset;
            const y = centerY_L;

            const isRed = (i === Math.floor(count / 4));
            
            lCtx.beginPath();
            lCtx.roundRect(x - 2, y - 25, isRed ? 6 : 3, 50, 5);
            lCtx.fillStyle = isRed ? '#f87171' : '#fbbf24';
            
            if (isRed) {
                lCtx.shadowBlur = 15;
                lCtx.shadowColor = '#f87171';
            } else {
                lCtx.shadowBlur = 4;
                lCtx.shadowColor = 'rgba(251, 191, 36, 0.3)';
            }
            lCtx.fill();
        }
        lCtx.shadowBlur = 0;
        drawWavelengthMarker(lCtx, lCanvas, amp, freq, speed, '#fbbf24');

        time += 1;
        requestAnimationFrame(draw);
    }

    document.getElementById('resetBtn').addEventListener('click', () => {
        inputs.amplitude.value = 40;
        inputs.frequency.value = 0.02;
        inputs.speed.value = 0.1;
        inputs.density.value = 50;
    });

    setTimeout(resize, 0);
    draw();
</script>
</body>
</html>
